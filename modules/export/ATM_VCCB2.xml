
<root>
<!-- RSSP_78013 -->
<Module name="ATM_ACQ">
<!-- 
0) CBR_SEQUENCE_NUMBERS ko can lam vi ko phai tai institution moi
2)     CAS_CLIENT_ACCOUNT  ko can cho ATM
3) cas_cycle_book_balance ko can
4) cbr_account_type
 4.1. CHT_ACCOUNT_TYPE_ID
 select * from CHT_ACCOUNT_TYPE_ID where INSTITUTION_NUMBER = 2001 and index_field = '098' order by 1;
098	Acqurer Dispute    doi thanh 'ATM Dispute'

Question 1:
 Should we use same account_type_id 012 Merchant payment for both ATM/POS? If we split ATM and POS, we should create a new account_type_id for ATM Account
012   Merch. Payment Acct
Question 2:
001	Cardholder Account    There are 03 cardHolder accounts in Issuer SC: 001	Prepaid Card Account; 002	Debit Card Account; 003	Credit Card Account. Should we align these two setup ????
--> 
	<export table="cis_client_links"> 
		<where> service_contract_id in ('057') and institution_number = '00000003' and client_number = '00000003' </where>
		<REPLACEVALUE>GROUP_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('018',1)
			CLIENT_NUMBER,00000003,00002001
		</REPLACEVALUE>
	</export>
	
	<export table="CHT_ACCOUNT_TYPE_ID"> 
		<where> index_field in ('001', '098') and institution_number = '00000000'  </where>
		<REPLACEVALUE>TYPE_ID,Acqurer Dispute,ATM Dispute</REPLACEVALUE>
	</export>

	<export table="cbr_account_type"> 
		<where> account_type_id in ('098')   </where>
	</export>
	
	<!--5. CBR_ACCT_RULES_GROUP and CBR_ACCT_RULES_INSTRUCTIONS 
	1000016185: rut tien ATM
	2000016148: gui tien vao ATM
	Note: Setup for bookng instruction to ATM acct ( merchant payment acct 012) is in  clearing_channel = '015' and transaction_class = 012 and transaction_type in 030 for Cash withdraw, 060 for Cash Deposit => this setup already included in Inst 2001 POS service contract=>  no need to add
	-->
	
	<export table="CBR_ACCT_RULES_INSTRUCTIONS" tag="WithdrawATM" parent="CBR_ACCT_RULES_GROUP" childrenField="RECORD_ID_NUMBER"> 
		<where> Institution_number = ':institution_number' and record_id_number in (select distinct record_id_number from CBR_ACCT_RULES_GROUP where Institution_number = ':institution_number' and clearing_channel in ('015') and transaction_type in ('009') and transaction_class in ('002'))   </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)</REPLACEVALUE>
	</export>
	<export table="CBR_ACCT_RULES_GROUP" tag="WithdrawATM" parentField="RECORD_ID_NUMBER"> 
		<where> clearing_channel in ('015') and transaction_type in ('009') and transaction_class in ('002') </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)</REPLACEVALUE>
	</export>
	
	<export table="CBR_ACCT_RULES_INSTRUCTIONS" tag="DepositATM" parent="CBR_ACCT_RULES_GROUP" childrenField="RECORD_ID_NUMBER"> 
		<where> Institution_number = ':institution_number' and record_id_number in (select distinct record_id_number from CBR_ACCT_RULES_GROUP where Institution_number = ':institution_number' and clearing_channel in ('015') and transaction_type in ('023') and transaction_class in ('002'))   </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)</REPLACEVALUE>
	</export>
	<export table="CBR_ACCT_RULES_GROUP" tag="DepositATM" parentField="RECORD_ID_NUMBER"> 
		<where> clearing_channel in ('015') and transaction_type in ('023') and transaction_class in ('002') </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)</REPLACEVALUE>
	</export>
	
	<!-- 	can phai add them mot so booking cho clearing 002 va settlement 005 cho inward Visa/Mastercard dung cho cash Withdraw -->
	<export table="CBR_ACCT_RULES_INSTRUCTIONS" tag="WithdrawATM" parent="CBR_ACCT_RULES_GROUP" childrenField="RECORD_ID_NUMBER"> 
		<where> Institution_number = ':institution_number' and record_id_number in (select distinct record_id_number from CBR_ACCT_RULES_GROUP where Institution_number = ':institution_number' and clearing_channel in (153, 155, 934, 936) and transaction_type in ('009') and transaction_class in ('005') and transaction_category in ('999'))   </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)</REPLACEVALUE>
	</export>
	<export table="CBR_ACCT_RULES_GROUP" tag="WithdrawATM" parentField="RECORD_ID_NUMBER"> 
		<where> clearing_channel in (153, 155, 934, 936) and transaction_type in ('009') and transaction_class in ('005') and transaction_category in ('999') </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)</REPLACEVALUE>
	</export>
	
	<export table="CBR_ACCT_RULES_INSTRUCTIONS" tag="WithdrawATM" parent="CBR_ACCT_RULES_GROUP" childrenField="RECORD_ID_NUMBER"> 
		<where> Institution_number = ':institution_number' and record_id_number in (select distinct record_id_number from CBR_ACCT_RULES_GROUP where Institution_number = ':institution_number' and clearing_channel in (153, 155, 934, 936) and transaction_type in ('009') and transaction_class in ('002') and transaction_category in ('999'))   </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)</REPLACEVALUE>
	</export>
	<export table="CBR_ACCT_RULES_GROUP" tag="WithdrawATM" parentField="RECORD_ID_NUMBER"> 
		<where> clearing_channel in (153, 155, 934, 936) and transaction_type in ('009') and transaction_class in ('002') and transaction_category in ('999') </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)</REPLACEVALUE>
	</export>
	
	<!-- lam tuong tu voi cash deposit 023 -->
	<export table="CBR_ACCT_RULES_INSTRUCTIONS" tag="WithdrawATM" parent="CBR_ACCT_RULES_GROUP" childrenField="RECORD_ID_NUMBER"> 
		<where> Institution_number = ':institution_number' and record_id_number in (select distinct record_id_number from CBR_ACCT_RULES_GROUP where Institution_number = ':institution_number' and clearing_channel in (153, 155, 934, 936) and transaction_type in ('023') and transaction_class in ('005') and transaction_category in ('999'))   </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)</REPLACEVALUE>
	</export>
	<export table="CBR_ACCT_RULES_GROUP" tag="WithdrawATM" parentField="RECORD_ID_NUMBER"> 
		<where> clearing_channel in (153, 155, 934, 936) and transaction_type in ('023') and transaction_class in ('005') and transaction_category in ('999') </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)</REPLACEVALUE>
	</export>
	
	<export table="CBR_ACCT_RULES_INSTRUCTIONS" tag="WithdrawATM" parent="CBR_ACCT_RULES_GROUP" childrenField="RECORD_ID_NUMBER"> 
		<where> Institution_number = ':institution_number' and record_id_number in (select distinct record_id_number from CBR_ACCT_RULES_GROUP where Institution_number = ':institution_number' and clearing_channel in (153, 155, 934, 936) and transaction_type in ('023') and transaction_class in ('002') and transaction_category in ('999'))   </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)</REPLACEVALUE>
	</export>
	<export table="CBR_ACCT_RULES_GROUP" tag="WithdrawATM" parentField="RECORD_ID_NUMBER"> 
		<where> clearing_channel in (153, 155, 934, 936) and transaction_type in ('023') and transaction_class in ('002') and transaction_category in ('999') </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)</REPLACEVALUE>
	</export>
	
	
	<!-- 6) cbr_service_contract -->
	<export table="CHT_SERVICE_CONTRACT_ID"> 
		<where> index_field in ('057')  and institution_number = '00000000'  </where>
	</export>
	<export table="CBR_SERVICE_CONTRACT"> 
		<where> service_contract_id in ('057')   </where>
	</export>
	
	<export table="CBR_CONTRACT_ACCT_TYPES"> 
		<where> service_contract_id in ('057') and  account_type_id in ('098')  </where>
		<REPLACEVALUE>ACCT_CURRENCY,704,978</REPLACEVALUE>
	</export>
	
	<!-- 7.CBR_ASSIGNED_SERVICES  suy nghi de gop them service_id giong acq POS cua Inst 2001 !!!!!!!
chu y cach chia nhom service_Id : (1) chia theo card_organization , hay (2) chia theo VIsaOnus, Mastercard Onus, VisaOffus, Mastercard Offus,  Domestic OffUs
	-->
	<export table="CHT_SERVICES"> 
		<where> index_field in (305, 307, 308, 309, 310) and institution_number = '00000000' </where>
		<REPLACEVALUE>SERVICE_ID,Acq-Napas,Acq National Domestic</REPLACEVALUE>
	</export>
	
	<export table="cbr_assigned_services"> 
		<where> service_contract_id in ('057') and service_category in ('002') </where>
	</export>

	<!-- 8.  CBR_SERVICE_definition gan tuong ung voi cac service da lua chon -->
	<export table="CBR_SERVICE_definition"> 
		<where> service_id in (305, 307, 308, 309, 310) and service_category in ('002')   </where>
	</export>
	
	<!-- 9 . CBR_SETTLEMENT_SCHEMES -->
	<export table="CBR_SETTLEMENT_SCHEMES"> 
		<where> service_contract_id in ('057')   </where>
		<REPLACEVALUE>ACCT_CURRENCY,704,978</REPLACEVALUE>
	</export>
	
	<!-- 10.CBR_POSTING_INSTRUCTIONS , could change area_of_event from Domestic to 999 (both international and Dom) for Account_type_id = 012
domestic everything goes to Account_type_id = 012
Chargeback goes to   Account_type_id = 098
Domestic Onus goes to   Account_type_id = 001
the transaction_category = '007' should goes to other account_type_id than 012 (maybe 001 oor 007)      ??? 
Question:  should we add 1 more account_type_id = 007- Merchant Fee Collection or 001 -Cardholder acct to control the fee/transaction charges???  transaction_category  = '007'
-->
	<export table="CBR_POSTING_INSTRUCTIONS"> 
		<where> service_contract_id in ('057') and account_type_id in ('001', '012', '098')   </where>
		<REPLACEVALUE>ACCT_CURRENCY,704,978</REPLACEVALUE>
	</export>
	
<!-- 11) CBR_CHANNEL_DEFINITION: transaction_source do nothing -->
	<export table="CBR_CHANNEL_DEFINITION"> 
		<where> transaction_source = '015'   </where>
		<REPLACEVALUE>SETTLEMENT_CURRENCY,704,978
		TRAN_CURRENCY,704,978</REPLACEVALUE>
	</export>
	<!-- Do we have National network outward channel ? If yes, we take. take more attention on client_number, 01281997 ATM?-->
	<export table="CBR_CHANNEL_DEFINITION" tag="NationalOutward"> 
		<where> transaction_destination in ('206', '313')   </where>
		<REPLACEVALUE>SETTLEMENT_CURRENCY,704,978
		TRAN_CURRENCY,704,978</REPLACEVALUE>
	</export>
	
	<!-- 12) CBR_TRANSACTION_CHARGES
	For merchant commision at ATM ( charge_type = 002) PL_IND_INW, it is ok to just setup. However, for the Interchange Fee for ATM which should be setup in Inst 15 with accordingly clearing_service contract, we have to DISCUSS...
	pay attention on x_currency, change it to EUR 978 or
inst 2001 has client_tariff 502 Blended POS
add client_tariff for ATM
	-->
	<export table="CBR_TRANSACTION_CHARGES"> 
		<where> SERVICE_CONTRACT_ID in ('057') and transaction_type in ('023','009','010','014')  </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)
		TRAN_CURRENCY,704,978
		FEE_CURRENCY,704,978
		</REPLACEVALUE>
	</export>
	<!-- 13) cbr_client_fees  no need to do anything -->
	<!-- 14) CBR_CURRENCY_RATES no need to do anything -->

</Module>

<Module name = "ATM_CLEARING"> 
	
<!-- What will system do with the interchange fee which Issuer must pay for Acquirer ? How will we book this interchange fee for ATM Acquirer? -->
	<export table="CHT_SERVICE_CONTRACT_ID"> 
		<where> index_field in ('206')  and institution_number = '00000000'  </where>
	</export>
	<export table="CBR_SERVICE_CONTRACT"> 
		<where> service_contract_id in ('206')   </where>
	</export>
	<export table="CHT_SERVICES"> 
		<where> index_field in (306,710,714) and institution_number = '00000000' </where>
	</export>
	<export table="cbr_assigned_services"> 
		<where> service_contract_id in ('206') and service_category in ('003') </where>
	</export>
	<!-- at the moment VCCB is mixing up the service_contract Acquiring ATM with Clearing service_id . We have to split it -->
	<export table="CBR_TRANSACTION_CHARGES"> 
		<where> service_id in (306,710,714)  </where>
		<REPLACEVALUE>RECORD_ID_NUMBER,v_seq_num,BW_CODE_LIBRARY.GETNEXTSEQNUMBER('015',1)
		TRAN_CURRENCY,704,978
		FEE_CURRENCY,704,978
		</REPLACEVALUE>
	</export>
</Module>

<Module name="Others">
<export table="ATMMS_BNA_ID_MAP"> 
		<where> institution_number = '00000003' </where>
	</export>
<export table="CHT_ACCOUNT_CONDITION_SET"> 
		<where> INDEX_FIELD in ('012') and institution_number = '00000000' </where>
		<REPLACEVALUE>index_field,012,000012
		</REPLACEVALUE>
	</export>
	<export table="CHT_TRANSACTION_TYPE"> 
		<where> INDEX_FIELD in ('009', '023') and institution_number = '00000000' </where>
	</export>
	<export table="CIS_APPLICATION_SERVICES"> 
		<where> service_contract_id in ('057') and service_id in (307,309)</where>
	</export>
	<export table="CHT_CLEARING_CHANNEL"> 
		<where> index_field in ('015') and institution_number = '00000000' </where>
	</export>
	<export table="CHT_POSTING_TARIFF"> 
		<where> index_field = '001' and institution_number = '00000000' </where>
		<REPLACEVALUE>index_field,001,011</REPLACEVALUE>
	</export>
	
	<export table="BWT_CLIENT_TARIFF_ACQUIRER"> 
		<where> index_field in ('012')   </where>
	</export>
	<export table="COS_ATM_LOCATION"> 
		<where> institution_number = '00000003'   </where>
	</export>
	
	<export table="CIS_CLIENT_LINKS"> 
		<where> CLIENT_NUMBER IN ('90145485')   </where>
		<REPLACEVALUE>PARENT_CLIENT_NUMBER,00000003,00002001</REPLACEVALUE>
	</export>
	
	<export table="CIS_DEVICE_LINK"> 
		<where> CLIENT_NUMBER IN ('90145485')   </where>
		<REPLACEVALUE>TERMINAL_CURRENCY,704,978</REPLACEVALUE>
	</export>
	
	<export table="CBR_CHART_OF_ACCOUNTS"> 
		<where> synth_extension = '003'  </where>
	</export>
	
	<export table="CBR_CHART_OF_ACCOUNTS"> 
		<where> clearing_channel = '025'  </where>
	</export>

	
	<export table="CBR_FX_RATE_RULES"> 
		<where> clearing_channel in ('003', '015', '025') </where>
	</export>

	<export table="CBR_ADDRESS_VALIDATION"> 
		<where> service_contract_id in ('057') </where>
	</export>
	
	<export table="CBR_PAYMENT_AGEING"> 
		<where> service_contract_id in ('057') </where>
	</export>
</Module>
</root>
