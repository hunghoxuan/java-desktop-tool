REM BAK NONE

DECLARE
	v_application_number VARCHAR2(8);
	v_institution_number VARCHAR2(8) := '00000114';

BEGIN
    --CLEANUP of ALL ALTO MERCHANTS
    for rec in (
		SELECT 	APPLICATION_NUMBER
		INTO 	v_application_number
		FROM 	CIS_APPLICATION_DETAIL
		WHERE 	INSTITUTION_NUMBER = v_institution_number
		AND		CLIENT_NUMBER NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004')
		AND 	ROWNUM = 1
	)
	loop
		---TODO PROPERLY
		DELETE FROM CIS_APPLICATION_DETAIL 		WHERE INSTITUTION_NUMBER = v_institution_number AND CLIENT_NUMBER NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004');
		DELETE FROM CIS_SETTLEMENT_INFORMATION 	WHERE INSTITUTION_NUMBER = v_institution_number AND CLIENT_NUMBER NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004');
		DELETE FROM CIS_CLIENT_LINKS 			WHERE INSTITUTION_NUMBER = v_institution_number AND CLIENT_NUMBER NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004');
		DELETE FROM CIS_ADDRESSES 				WHERE INSTITUTION_NUMBER = v_institution_number AND CLIENT_NUMBER NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004');
		DELETE FROM CIS_CLIENT_ADDENDUM 		WHERE INSTITUTION_NUMBER = v_institution_number AND CLIENT_NUMBER NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004');
		DELETE FROM CAS_CLIENT_ACCOUNT 			WHERE INSTITUTION_NUMBER = v_institution_number AND CLIENT_NUMBER NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004');
		DELETE FROM CAS_CLIENT_ACCOUNT 			WHERE INSTITUTION_NUMBER = v_institution_number AND CLIENT_NUMBER NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004');
		DELETE FROM CAS_ACCOUNT_CHANGE_HISTORY 	WHERE INSTITUTION_NUMBER = v_institution_number AND substr(ACCT_NUMBER,1,8) NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004');
		DELETE FROM CIS_CLIENT_DETAILS 			WHERE INSTITUTION_NUMBER = v_institution_number AND CLIENT_NUMBER NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004');
		DELETE FROM CIS_DEVICE_LINK 			WHERE INSTITUTION_NUMBER = v_institution_number AND CLIENT_NUMBER NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004');
		DELETE FROM CAS_CYCLE_BOOK_BALANCE 		WHERE INSTITUTION_NUMBER = v_institution_number AND substr(ACCT_NUMBER,1,8) NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004');
		DELETE FROM SVC_CLIENT_SERVICE 			WHERE INSTITUTION_NUMBER = v_institution_number AND CLIENT_NUMBER NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004');
		DELETE FROM CPS_PORTAL_USER_ACTIVATION  WHERE USERID IN (	SELECT 	USERID
																	FROM 	CPS_USER_INFORMATION
																	WHERE 	INSTITUTION_NUMBER = v_institution_number
																	AND 	CLIENT_NUMBER NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004'));
		DELETE FROM CPS_USER_INFORMATION		WHERE INSTITUTION_NUMBER = v_institution_number AND CLIENT_NUMBER  NOT IN ('00000114', '90000001', '90000002', '90000003', '90000004');
		
		DELETE FROM CIS_APPLICATION_ADDR where institution_number = '00000114' and application_number not in (select application_number from CIS_APPLICATION_DETAIL where institution_number = '00000114');

		DELETE from CIS_APPLICATION_ACCT_TYPE where institution_number = '00000114' and application_number not in (select application_number from CIS_APPLICATION_DETAIL where institution_number = '00000114');

		DELETE FROM CIS_APPLICATION_SERVICES where institution_number = '00000114' and application_number not in (select application_number from CIS_APPLICATION_DETAIL where institution_number = '00000114');	
			
		DELETE FROM CIS_APPL_CLIENT_ADDENDUM where institution_number = '00000114' and application_number not in (select application_number from CIS_APPLICATION_DETAIL where institution_number = '00000114');
	end loop;

	COMMIT;

END;
/
